---
title: Who uses Socrata?
tweet_text: That time I downloaded all of the 80,000 @socrata datasets, I downloaded the 10,000 users.
---

(Introduction here)


My [first post](/!/socrata-summary) looked at popular datasets, and
my [second post](/!/socrata-genealogies) looked at big dataset families.
In this third post, I look at heavy and otherwise interesting users.

## The user data format
![Diagram indicating that each view has one owner and one table author](<%= @item.identifier %>format-sketch.jpg)

I'm still using the same 80,000 JSON files that I downloaded last month.
Each of these metadata files describes a Socrata [view](/!/socrata-genealogies#term-view).
Some of these JSON files are duplicates (because of
[federation](/!/socrata-genealogies#term-federation)),
so there are only about 50,000 unique views.

Among their many
fields are two fields related to the people who interacted with that view.
These fields are the `owner` and  `tableAuthor` fields. These fields are
both hashes/dictionaries/arrays with user information. For example, here's
mine.

    {
        "id" : "x73b-9d8f",
        "displayName" : "Thomas Levine",
        "emailUnsubscribed" : false,
        "privacyControl" : "login",
        "profileLastModified" : 1371141485,
        "screenName" : "Thomas Levine"
    }

### `owner`
The `owner` field is quite straightforward; it's simply the person who
created the view, be it a
[dataset](/!/socrata-genealogies#term-dataset),
[chart](/!/socrata-genealogies#term-chart),
[map](/!/socrata-genealogies#term-map) or
[whatever](/!/socrata-genealogies#term-other-view-types).

### `tableAuthor`
The `tableAuthor` field is the person who uploaded the
[table](/!/socrata-genealogies#term-table) (source data) associated
with the view. For datasets, this is the same as the owner, but for charts,
maps and filtered views, it might be different; one person may have uploaded
the data, and another person might have made the chart. "view", "dataset",
"map", "chart", "filtered view" and "table" all have rather special meanings
inside Socrata, so you should read my [post on that](/!/socrata-genealogies)
if the previous sentence didn't make sense.

## Extracting the user data
I already had a system for storing all of the Socrata metadata, so I just needed to write a
[sloppy function](https://github.com/tlevine/socrata-analysis/blob/e3d12254e928f986f1a83ed2099577e289048b94/numbers/run.py#L207)
to query it. This resulted in an SQLite3 database, which I converted to a
[CSV file](https://raw.github.com/tlevine/socrata-analysis/e3d12254e928f986f1a83ed2099577e289048b94/users.csv)
and read into R.

Rather than remembering which tables and datasets everyone owned, that function
just remembers how many. Maybe I'll do something with the links later.

## Analysis
The user data frame schema looks like this.

```{r schema}
str(users)
```

### Missing data
Not everyone had all of the fields.

```{r missingness}
a <- t(as.data.frame(lapply(users, function(variable){ sum(!is.na(variable)) } )))
missingness <- data.frame(
  variable = rownames(a),
  present.value = a[,1]
)
missingness <- missingness[order(missingness$present.value, decreasing = T),]
barplot(
  (missingness$present.value),
  names.arg = missingness$variable,
  border = NA, col = 'grey', axes = F, horiz = T, las = 1,
  xlim = c(0, 12000),
  main = 'How complete is the user profile metadata?',
  xlab = 'Number of users with the field',
  ylab = 'Field'
)
axis(1, at = seq(0, 12000, 2000))
abline(v = nrow(users), col = 2, lty = 2)
text(x = nrow(users), y = 15, labels = paste(nrow(users), 'total users'), col = 2, pos = 2)
text(x = 2500, y = 14, labels = 'Missing data', col = 2)
text(x = 10000, y = 3, labels = 'Complete data', col = 2)
```

### How many views do people have?

```{r n.views}
plot.count(users$n_views, 'views', col = (users$id == 'e8ug-wzay') + 1)
text(x = 0.2, y = 1.2, labels = 'Most users\nhave one view', pos = 4, col = 2)
text(x = 3.5, y = 1.5, labels = 'Data.gov Program\nManagement Office', col = 2)
```

Most users (``sum(users$n_views == 1)`` to be exact) have exactly one view.
Actually, there are probably even more with no views, but I don't have the
data on them.

That one way off to the side is the Data.gov Program Management Office,
with ``users['e8ug-wzay','n_views']``. 

Let's try that again, but I'm going to color the plot by whether the user's role
is "administrator" or "publisher". (Other possibilities are "designer", "editor",
"publisher", "viewer" and a missing value.)

```{r n.views.byrole}
plot.count(users$n_views, 'views', col = 1 + (!is.na(users$roleName) & (users$roleName == 'publisher' | users$roleName == 'administrator')))
```

It looks like publishers and administrators (red) make more views. Big surprise.

### How many tables?

Let's make that same plot but for the number of tables. (A table is a raw
uploaded dataset, before any view filtering. A table can have many views,
and a view has only one table.)

```{r n.tables}
plot.count(users$n_tables, 'tables', col = 1 + (!is.na(users$roleName) & (users$roleName == 'publisher' | users$roleName == 'administrator')))
text(x = 0.2, y = 1.2, labels = 'Most users\nhave one table', pos = 4, col = 2)
text(x = 3.5, y = 1.5, labels = 'Data.gov Program\nManagement Office', col = 2)
```

That point off to the right is again the Data.gov Program Management Office.o

### How many derived views?
When you upload a tabular data file to Socrata, Socrata creates a "table" and
a "dataset" view on that table. When you filter a view inside Socrata, Socrata
creates a new view but no new table. Thus, the difference between number of
tables and number of views tells us how many derived views people have made.
I think.

```{r n.derived}
plot.count(users$n_views - users$n_tables, 'derived views', col = 1 + ((!is.na(users$roleName) & (users$roleName == 'publisher' | users$roleName == 'administrator'))))
```

It also turns out that 65 users have more tables than views. This appears to be
mostly publishers. Maybe this is something about how the import API works that I
don't understand.

## Aside from data publishers and Socrata employees, who uses Socrata a lot?

### More tables than views
Here are people with tables but no views. (As I mentioned earlier, I didn't
realize that this was possible!) I figure that these people are probably
data publishers.

```{r data.publishers.2}
subset(users, n_tables > n_views)[c('displayName', 'roleName', 'flags', 'n_tables', 'n_views')]
```

I looked up a few of them with a search engine, and they mostly
[seem](http://www.linkedin.com/in/jkray)
[to](http://www.imaginaryrobots.net/resumes/Jesse_van_Herk_resume.pdf)
[be](http://www.linkedin.com/in/debraagagne)
[government](http://www.whitehouse.gov/champions/technology-and-innovation/waldo-jaquith)
[employees](http://waldo.jaquith.org/).

#### Private data
An interesting case is
[rseel](https://data.oregon.gov/profile/rseel/izyb-s78c?category=Recreation&utf8=%E2%9C%93&view_type=table).
He is the author behind a private table, and 
[Cam Caldwell](), a Socrata employee, made 
[this view](https://data.oregon.gov/Health-Human-Services/WIC-Authorized-Vendors/5ew8-h6d9?)
based on that table. So some of the situations where people have tables but no views might
occur because of private views.

### How can we find ordinary citizens?

#### `roleName`
You may have noticed that most of the people in the above tables have
`roleName` fields. I think that people tend to have a `roleName` field
if and only if they work for data publishers. To make that more clear,
here's a table.

```{r data.publishers}
users$has.role <- !is.na(users$roleName)
```

```{r roleName.for.govt}
table(users$n_tables > users$n_views, users$has.role)
```

Here's a plot.

```{r roleName.plot}
users$more.tables <- users$n_tables > users$n_views
users.roleNames <- ddply(users, 'more.tables', function(df) {
  out <- data.frame(
    has.role = c(T,F),
    prop = c(
      mean(df$has.role),
      1 - mean(df$has.role)
    )
  )
})
barplot(users.roleNames$prop[users.roleNames$more.tables],
  names.arg = c('Has a roleName', 'No roleName'),
  ylim = 0:1, border = NA, las = 1,
  ylab = 'Proportion of users with more tables than views',
  xlab = 'User group', main = 'Are roleNames for data publisher employees?'
)
```

And if we want to get all statistical about it, we can run
Fisher's Exact test on that table.

```{r fisher.test}
fisher.test(table(users$n_tables > users$n_views, users$has.role))
```

and find that these counts are indeed disproportionate. 

This is all to say that **`roleName` appears to be a decent proxy for "data publisher"**.

#### `flags`
In a similar vein, I looked at Socrata users with a `flags` field.

```{r socrata.employees}
users$has.flag <- !is.na(users$flags)
subset(users, has.flag)['displayName']
```

These appear to all be Socrata employees.

Hmm. Does anyone have both a `roleName` and a flag?

```{r rolename.and.flag}
subset(users, has.flag & has.role)[c('displayName', 'roleName')]
```

[Beth](http://www.socrata.com/newsroom-article/government-innovator-beth-blauer-joins-socrata/)
and [Bryant](www.linkedin.com/in/bryantlau) are both
Socrata employees. I don't know why they have `roleName` fields.

Anyway, it looks like the **`flags` field is a decent proxy for "Socrata employee"**.

### Heavy users who work neither for government nor Socrata
If having a `flags` field means you work for Socrata and
having a `roleName` means you work for a data publisher (a government, usually),
then people with neither `flags` nor a `roleName` are the
citizens that Socrata is trying to empower.

```{r citizens}
citizens <- subset(users, !has.flag & !has.role)
columns <- c('displayName', 'n_tables', 'n_views')
head(citizens[order(citizens$n_views, decreasing = T),columns])
```

Hmm okay they're not all citizens. For example,
"[Public Datasets](https://opendata.socrata.com/profile/Public-Datasets/vc35-nh3p)"
appears to be [recovery.gov](http://www.recovery.gov)'s open data initiative,
which is running on [opendata.socrata.com](https://opendata.socrata.com)
rather than on a separate portal.

Maybe we should also expect citizens not to have uploaded any tables.

```{r citizens.2}
citizens <- subset(users, !has.flag & !has.role & n_tables == 0)
head(citizens[order(citizens$n_views, decreasing = T),columns])
```

Now we're getting somewhere.

[Njbate](https://explore.data.gov/profile/Njbate/jyr3-c2kp?)
made a bunch of filtered views on the
[FEC Contributions dataset](https://explore.data.gov/Contributors/FEC-Contributions/4dkz-64bn).

[CPHA](https://data.baltimorecity.gov/profile/CPHA/cif6-aywu?)
made a bunch of filtered views on the
[Baltimore 311 request dataset](https://data.baltimorecity.gov/Community/311-Customer-Service-Requests/9agw-sxsr).

The [Kenya Open Data Bot](https://opendata.go.ke/profile/Kenya-Open-Data-Bot/teh5-ns3w?)
made a bunch of charts on a few different datasets.
These charts are quite popular, and they account for a quarter of Kenya's open data portal.

Anyway, I see a pattern here: Users with the most views
just made different filters on the same dataset.

Let's try this yet again, but this time, let's look only at people with profile images.

```{r citizens.3}
citizens <- subset(users, !has.flag & !has.role & n_tables == 0 & !is.na(profileImageUrlLarge))
columns <- c('displayName', 'n_tables', 'n_views', 'profileImageUrlLarge')
head(citizens[order(citizens$n_views, decreasing = T),columns], 10)
```

I ran queries like this to find what portals and data they used.

    subset(socrata, owner.id == 'aeze-ppu4')[c('portal', 'id', 'tableId', 'name', 'viewCount')]
    table(subset(socrata, owner.id == 'aeze-ppu4')$portal)

They look more like real people doing real analysis.

#### not The White House
![not The White House](images/not The White House.jpg)

[not The White House](https://explore.data.gov/profile/not-The-White-House/732w-crxq)
is "[w]ay more open and transparent than the official White House website."
It's another account that's just making filters on one dataset, but they're a bit more
creative, diverse and involved. Here are some of her popular views.

* [People who went on the West Wing tour](https://explore.data.gov/dataset/West-Wing-Tour/e8wt-55cb)
* [People who played basketball at the White House](https://explore.data.gov/dataset/People-who-played-basketball-at-the-White-House/a4h3-3v3x)
* [Secret Service BBQ](https://explore.data.gov/dataset/Secret-Service-BBQ/tgmj-eaig)

not The White House also has its own separate website, 
[whitehouse.gov1.info](http://whitehouse.gov1.info/),
which is a parody of the [official White House website](http://www.whitehouse.gov/).

#### NL
![Picture of NL](<%= @item.identifier %>NL.jpg)

[NL](https://finances.worldbank.org/profile/NL/aeze-ppu4)
used to do a lot with World Bank data, though she hasn't for a few months.

She also has some views
[on databox.worldbank.org](https://databox.worldbank.org/profile/NL/aeze-ppu4).
Interestingly, that portal didn't show up in my list of Socrata portals.


#### VinylFox
![Picture of VinylFox](<%= @item.identifier %>VinylFox.jpg)

[VinylFox](https://data.baltimorecity.gov/profile/VinylFox/86yi-jydw?)
has also made a bunch of interesting filters on Baltimore data.
His website discusses this [a bit more](http://www.vinylfox.com/about/).
<!-- Talk to him. -->

#### Dave Francis Rodrigues
![Picture of Dave Francis Rodrigues](<%= @item.identifier %>Dave Francis Rodrigues.jpg)

[Dave](https://finances.worldbank.org/profile/Dave-Francis-Rodrigues/ef7y-9vvy?)
has made a lot of filters and charts about India.
He also names his views really well. In particular, I like his hack of prefixing
all of the titles with "Dave_"; this gets around how Socrata doesn't make it particularly
clear who created the view that you are looking at.

### People mostly use one portal.
When you make an account on any Socrata portal, you can use it to log in to
any of the other portals. Although this makes it easier for people to use
different portals, people don't seem to be doing that; people seem to stick
to just one portal.

(As I mentioned [previously](),
I think that all of the different Socrata portals are served from the
same web application and that this is why you can use the same credentials.)

<!-- discussion -->
Part of the issue might be that it is difficult to search across portals.

### Everyone else
I looked at a few specific Socrata users who are doing interesting things,
but let's look a bit more broadly. The histogram below shows how many views
users have created. Here, I'm including people without profile pictures.

```{r citizen.views.1}
citizens <- subset(users, !has.flag & !has.role & n_tables == 0)
hist(citizens$n_views,
  col = 1, border = NA,
  xlab = 'Number of Socrata views created by the user',
  ylab = 'Number of users', main = 'How many views do Socrata users make?'
)
```

Here it is again, but leaving out the top ten users to make it easier to see.

```{r citizen.views.2}
citizens <- subset(users, !has.flag & !has.role & n_tables == 0)
hist(citizens$n_views[citizens$n_views < 30],
  col = 1, border = NA,
  xlab = 'Number of Socrata views created by the user',
  ylab = 'Number of users', main = 'How many views do Socrata users make?'
)
```

As you might expect, most people make only one view.
In fact, there are probably even more users with no views.

### More about views
I remembered that I had the whole views dataset as well, so I connected the user
data back to that. In the following plot, each dot is a view. The location along
the Y axis indicates the user that created it, the location along the X axis
indicates the date of publication.

```{r user.views.1}
p <- ggplot(user.views) + aes(x = date, y = userid) + 
  theme(axis.text.y=element_blank(), axis.title.y = element_text('User creating the view'), axis.ticks.y = element_blank()) +
  scale_x_date('View publication date')
p + geom_point(alpha = 1/20)
```

The horizontal lines are users who have consistently created views for a while.
The vertical bands are situations when lots of different users created views all
around the same date.

Let's add some more variables. In this next one, color is the type of view
and size is the number of cells.

```{r user.views.2}
p + aes(color = viewType, size = nrow * ncol) + scale_size_continuous('Number of cells', labels = comma) +
 geom_point(alpha = 1/10)
```

Now we can also see when the larger datasets and the non-tabular datasets were created.

By the way, this is wonderful example of where not to use R. I want to be able to click
on all of these points and see the specific user. I could use one of the
interactive graphics R packages, but I think it's easier to make a web thing.
Maybe some other time. For now, I'll see how far I can get with the static graph before I get bored.

### What are those vertical bands?
We see vertical bands at early 2008, early 2009 and late 2011. What's going on there?

#### Late 2011
The late 2011 band happened right at the beginning of October.
Maybe it was a new portal getting online?

<!-- 
p + geom_point(alpha = 1/20) +
  geom_vline(xintercept = as.numeric(as.Date('2011-09-01'))) +
  geom_vline(xintercept = as.numeric(as.Date('2011-10-01')))
-->

```{r late.2011}
socrata$month <- factor(strftime(socrata$date, '%B'), levels =
  c('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'))
late.2011 <- subset(socrata, date >= '2011-06-01' & date < '2012-01-01')
ggplot(ddply(late.2011, c('portal', 'month'), function(x) {c(count = nrow(x))})) +
  aes(x = month, y = count, group = portal, fill = portal) + geom_area()
```

Hmm. No single portal seems to be responsible. My guess is that
it has something to do with the
[release of the API foundry](http://www.socrata.com/newsroom-article/socrata-introduces-api-foundry-and-ushers-in-the-era-of-api-enabled-data-ecosystems/).

#### Early 2008 and early 2009
Before late 2009, [opendata.socrata.com](https://opendata.socrata.com) was the only
data portal. That is all of the views that were created before late 2009 are on
opendata.socrata.com. So here, too, it's not like a new portal was created.
I don't really know what was going on here either.
<!-- table(subset(socrata, createdAt < '2009-05-01')$portal) -->

### Horizontal bands
A few users made many rather consistent uploads, some for rather sustained periods of time.
Let's take a look at some of them.

Here are some users who made a lot of views in a really short time.

```{r user.intensity.2}
user.intensity <- subset(ddply(user.views, 'userid', function(df){
  c(n = nrow(df),
    first = min(df$date),
    last = max(df$date)
  )
}), n > 10)

intense.users.ids <- data.frame(userid = user.intensity[order((user.intensity$last - user.intensity$first) / user.intensity$n, decreasing=T),'userid'][1:10])
intense.users.views <- sqldf('select * from "user.views" join "intense.users.ids" join socrata where "user.views".userid = "intense.users.ids".userid and "user.views".viewid = socrata.id')
ggplot(intense.users.views) + aes(y = date, x = userid, label = name) +
  scale_y_date('View publication date') + geom_text()
```

They mostly seem to be playing with Socrata and making views as tests.

Here are some users who have been making views for a really long time.
Specifically, they're the ten users with the longest time difference
between the publication dates of their most recent and first views.

Chris Metcalf, Clint Tseng, Jeff Sherpelz, Paul Paradise and Kevin Merritt work for Socrata.

[David Beard](https://opendata.socrata.com/profile/David-Beard/re3b-zge9)
has [ten datasets](https://opendata.socrata.com/profile/David-Beard/re3b-zge9?limitTo=datasets)
and a bunch of filters on those datasets.

The [White House](https://opendata.socrata.com/profile/whitehouse/bhnt-uir2)
has a bunch of datasets on opendata.socrata.com.

The [New York State Senate](https://opendata.socrata.com/profile/New-York-State-Senate/7f5i-r9x4)
releases a payroll dataset each week.

The Seattle [Department of Information Technology](https://data.seattle.gov/profile/Department-of-Information-Technology/pfbu-yuv5)
manages Seattle's portal.

The [Washington Examiner](https://opendata.socrata.com/profile/Washington-Examiner/uqfw-aksw)
is a [DC newspaper](http://washingtonexaminer.com/).

And here's a plot of their activity.

```{r user.intensity.3}
intense.users.ids <- data.frame(userid = user.intensity[order(user.intensity$last - user.intensity$first, decreasing=T),'userid'][1:10])
intense.users.ids$username <- users[as.character(intense.users.ids$userid),'displayName']
intense.users.views <- sqldf('select * from "user.views" join "intense.users.ids" join socrata where "user.views".userid = "intense.users.ids".userid and "user.views".viewid = socrata.id')
ggplot(intense.users.views) + aes(y = date, x = username, label = name) +
  scale_y_date('View publication date') + geom_text()
```

I'm sort of surprised that people are using opendata.socrata.com so consistently.

## Conclusions, lessons, ideas, &c.

### API documentation
Most of my work on this is still just in figuring out what the API fields mean.
Some of you reading this are probably building developer APIs, so keep this in
mind: If you don't document your API fully, some random person might come along
and document it for you, which might be both highly embarassing and highly convenient.

### Big users
Unsurprisingly, data publishers create lots of views. And Data.gov is crazy.
Aside from data publishers, there are a few accounts that make lots of filters
on the same dataset. These accounts might be bots; one of them is even called
the "Kenya Open Data Bot".

I found some accounts (not The White House, NL, VinylFox and Dave Francis
Rodrigues) that seem to be using Socrata's filtering, mapping and
charting tools to relate different datasets to a particular research topic.

I started looking into accounts that had been consistently active and trying
to figure out why jumps in activity happened at certain times. I didn't get
very far with either of these, so it would be interested to look more closely.

### One portal
Very few of the big users that I discuss above uses more than one Socrata portal.
This certainly makes sense as Socrata open data portals are presented as if they're
separate installations of the software. You can use the same account for all of the
portals, but there's no obvious way to search across portals or get a list of all
of the portals.

As I've discussed earlier, I think that all Socrata sites are served from the same
instance of a web application, so I think it wouldn't be too difficult technically
to make it easier for people to use data from different portals. A particularly
simple approach would be to create a separate Socrata instance that federates all
of the others. I wonder whether people would use the Socrata Open Data Portal
differently if they could easiy collect and analyze data from all of the portals.

On the other hand, maybe it wouldn't matter. A couple of the bigger users I found
were using World Bank data. It's quite possible that the data in the other portals
aren't that relevant to them.
